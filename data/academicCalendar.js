export const academicCalendar = {
  title: "Kalender Akademik Universitas Mikroskil",
  year: "T.A. 2024/2025",
  schedules: [
    {
      category: "A",
      name: "Persiapan Awal Semester",
      items: [
        {
          id: "A1",
          name: "Mahasiswa Baru",
          subitems: [
            {
              id: "A1.1",
              name: "Mikroskil Freshmen-Year Experience Program",
              oddSemester: "12 September - 14 September 2024",
              evenSemester: "-",
            },
            {
              id: "A1.2",
              name: "Matrikulasi (Khusus program Magister)",
              oddSemester: "9 September - 13 September 2024",
              evenSemester: "24 Februari - 28 Februari 2025",
            },
          ],
        },
        {
          id: "A2",
          name: "Mahasiswa Lama",
          subitems: [
            {
              id: "A2.1",
              name: "Periode Permohonan Pindah Waktu Kuliah",
              oddSemester: "8 Juli - 13 Juli 2024",
              evenSemester: "20 Januari - 25 Januari 2025",
            },
            {
              id: "A2.2",
              name: "Periode Permohonan Penundaan Kegiatan Akademik",
              oddSemester: "3 Juni - 13 Juli 2024",
              evenSemester: "6 Januari - 25 Januari 2025",
            },
            {
              id: "A2.3",
              name: "Konseling Pengambilan Mata Kuliah (Nonsemester dan Pindahan)",
              oddSemester: "15 - 19 Juli 2024",
              evenSemester: "3 Februari - 8 Februari 2025",
            },
          ],
        },
      ],
    },
    {
      category: "B",
      name: "Registrasi Administrasi (Pembayaran Uang Kuliah)",
      items: [
        {
          id: "B1",
          name: "Pengajuan Potongan Saudara Kandung atau Lunas",
          oddSemester: "1 Mei - 31 Mei 2024",
          evenSemester: "-",
        },
        {
          id: "B2",
          name: "Pembayaran Lunas dan Cicilan I",
          oddSemester: "1 Juli - 11 Juli 2024",
          evenSemester: "-",
        },
        {
          id: "B3",
          name: "Cicilan II",
          oddSemester: "30 September - 10 Oktober 2024",
          evenSemester: "-",
        },
        {
          id: "B4",
          name: "Cicilan III",
          oddSemester: "30 Desember - 9 Januari 2025",
          evenSemester: "-",
        },
        {
          id: "B5",
          name: "Cicilan IV",
          oddSemester: "-",
          evenSemester: "1 April - 11 April 2025",
        },
      ],
    },
    {
      category: "C",
      name: "Registrasi Akademik",
      items: [
        {
          id: "C1",
          name: "Pengisian Kartu Rencana Studi (KRS)",
          oddSemester: "23 Juli - 26 Juli 2024",
          evenSemester: "10 Februari - 13 Februari 2025",
        },
        {
          id: "C2",
          name: "Persetujuan KRS oleh Dosen Wali",
          oddSemester: "27 Juli 2024",
          evenSemester: "14 Februari 2025",
        },
        {
          id: "C3",
          name: "Batas akhir pemrosesan KRS oleh Program Studi",
          oddSemester: "4 September 2024",
          evenSemester: "19 Februari 2025",
        },
        {
          id: "C4",
          name: "Finalisasi Pengisian KRS",
          oddSemester: "7 September 2024",
          evenSemester: "22 Februari 2024",
        },
      ],
    },
    {
      category: "D",
      name: "Magang Mandiri",
      items: [
        {
          id: "D1",
          name: "Sosialisasi Lowongan Magang",
          oddSemester: "15 Juli - 20 Juli 2024",
          evenSemester: "16 Desember - 21 Desember 2024",
        },
        {
          id: "D2",
          name: "Pendaftaran oleh Mahasiswa",
          oddSemester: "15 Juli - 16 Agustus 2024",
          evenSemester: "21 Desember 2024 - 5 Februari 2025",
        },
        {
          id: "D3",
          name: "Seleksi Administratif oleh Universitas",
          oddSemester: "1 Agustus - 16 Agustus 2024",
          evenSemester: "6 Februari - 8 Februari 2025",
        },
        {
          id: "D4",
          name: "Seleksi Administratif oleh Mitra",
          oddSemester: "19 Agustus - 23 Agustus 2024",
          evenSemester: "10 Februari - 14 Februari 2025",
        },
        {
          id: "D5",
          name: "Pelaksanaan Magang",
          oddSemester: "September 2024",
          evenSemester: "Maret 2025",
        },
      ],
    },
    {
      category: "E",
      name: "Pembimbingan Akademik / Perwalian",
      items: [
        {
          id: "E1",
          name: "Perwalian I",
          oddSemester: "17 September - 21 September 2024",
          evenSemester: "3 Maret - 8 Maret 2025",
        },
        {
          id: "E2",
          name: "Perwalian II",
          oddSemester: "28 Oktober - 9 November 2024",
          evenSemester: "21 April - 3 Mei 2025",
        },
        {
          id: "E3",
          name: "Perwalian III",
          oddSemester: "25 November - 30 November 2024",
          evenSemester: "19 Mei - 24 Mei 2025",
        },
        {
          id: "E4",
          name: "Perwalian IV",
          oddSemester: "6 Januari - 18 Januari 2025",
          evenSemester: "23 Juni - 5 Juli 2025",
        },
      ],
    },
    {
      category: "F",
      name: "Perkuliahan dan Ujian",
      items: [
        {
          id: "F1",
          name: "Perkuliahan Pra Ujian Tengah Semester (UTS)",
          oddSemester: "17 September - 2 November 2024",
          evenSemester: "3 Maret - 26 April 2025",
        },
        {
          id: "F2",
          name: "Batas Akhir Pengunggahan Soal UTS",
          oddSemester: "26 Oktober 2024",
          evenSemester: "19 April 2025",
        },
        {
          id: "F3",
          name: "Libur Persiapan UTS / Pengganti Kuliah Hari Libur / Besar",
          oddSemester: "4 November - 9 November 2024",
          evenSemester: "28 April - 3 Mei 2025",
        },
        {
          id: "F4",
          name: "UTS",
          oddSemester: "11 November - 16 November 2024",
          evenSemester: "5 Mei - 10 Mei 2025",
        },
        {
          id: "F5",
          name: "Pendaftaran dan Pembayaran UTS Susulan",
          oddSemester: "8 November - 15 November 2024",
          evenSemester: "2 Mei - 9 Mei 2025",
        },
        {
          id: "F6",
          name: "UTS Susulan",
          oddSemester: "20 November - 22 November 2024",
          evenSemester: "14 Mei - 16 Mei 2025",
        },
        {
          id: "F7",
          name: "Pengajuan Koreksi Nilai UTS",
          oddSemester: "2 Desember 2024",
          evenSemester: "26 Mei 2025",
        },
        {
          id: "F8",
          name: "Perkuliahan Pra Ujian Akhir Semester (UAS)",
          oddSemester: "18 November 2024 - 12 Januari 2025",
          evenSemester: "12 Mei - 28 Juni 2025",
        },
        {
          id: "F9",
          name: "Batas Akhir Pengunggahan Soal UAS",
          oddSemester: "4 Januari 2025",
          evenSemester: "21 Juni 2025",
        },
        {
          id: "F10",
          name: "Libur Persiapan UAS / Pengganti Kuliah Hari Libur / Besar",
          oddSemester: "13 Januari - 18 Januari 2025",
          evenSemester: "30 Juni - 5 Juli 2025",
        },
        {
          id: "F11",
          name: "UAS",
          oddSemester: "20 Januari - 25 Januari 2025",
          evenSemester: "7 Juli - 12 Juli 2025",
        },
        {
          id: "F12",
          name: "Pendaftaran dan Pembayaran UAS Susulan",
          oddSemester: "17 Januari - 24 Januari 2025",
          evenSemester: "4 Juli - 11 Juli 2025",
        },
        {
          id: "F13",
          name: "UAS Susulan",
          oddSemester: "5 Februari - 7 Februari 2025",
          evenSemester: "16 - 18 Juli 2025",
        },
        {
          id: "F14",
          name: "Pengajuan Koreksi Nilai UAS",
          oddSemester: "10 Februari 2025",
          evenSemester: "28 Juli 2025",
        },
      ],
    },
    {
      category: "G",
      name: "Semester Pendek (Khusus Program Magister)",
      items: [
        {
          id: "G1",
          name: "Perkuliahan dan Ujian",
          oddSemester: "3 Februari - 1 Maret 2025",
          evenSemester: "14 Juli - 9 Agustus 2025",
        },
      ],
    },
    {
      category: "H",
      name: "Akhir Semester",
      items: [
        {
          id: "H1",
          name: "Evaluasi Proses Belajar Mengajar terhadap Dosen oleh Mahasiswa",
          oddSemester: "6 Januari - 15 Februari 2025",
          evenSemester: "23 Juni - 2 Agustus 2025",
        },
        {
          id: "H2",
          name: "Evaluasi Kepuasan Layanan",
          oddSemester: "6 Januari - 15 Februari 2025",
          evenSemester: "23 Juni - 2 Agustus 2025",
        },
        {
          id: "H3",
          name: "Pendaftaran dan Pembayaran Ujian Remedial Semester",
          oddSemester: "17 Februari - 18 Februari 2025",
          evenSemester: "4 Agustus - 6 Agustus 2025",
        },
        {
          id: "H4",
          name: "Ujian Remedial Semester",
          oddSemester: "24 Februari - 28 Februari 2025",
          evenSemester: "18 - 22 Agustus 2025",
        },
        {
          id: "H5",
          name: "Pendaftaran dan Pembayaran Ujian Remedial Ulang",
          oddSemester: "-",
          evenSemester: "4 Agustus - 6 Agustus 2025",
        },
        {
          id: "H6",
          name: "Ujian Remedial Ulang",
          oddSemester: "-",
          evenSemester: "18 - 22 Agustus 2025",
        },
        {
          id: "H7",
          name: "Batas Akhir Pemrosesan Kartu Hasil Studi (KHS)",
          oddSemester: "8 Maret 2025",
          evenSemester: "20 September 2025",
        },
        {
          id: "H8",
          name: "Batas Akhir Evaluasi Kemajuan Studi Mahasiswa oleh Fakultas / Program Studi",
          oddSemester: "-",
          evenSemester: "30 Agustus 2025",
        },
        {
          id: "H9",
          name: "Pembimbingan Prestasi Akademik Mahasiswa oleh Bagian Kemahasiswaan",
          oddSemester: "Februari 2025",
          evenSemester: "Agustus 2025",
        },
      ],
    },
    {
      category: "I",
      name: "Tugas Akhir / Tesis",
      items: [
        {
          id: "I1",
          name: "Permohonan Judul Skripsi / Tugas Akhir /Tesis",
          oddSemester: "23 Juli - 19 September 2024",
          evenSemester: "3 Februari - 6 Maret 2025",
        },
        {
          id: "I2",
          name: "Pembayaran Biaya Skripsi / Tugas Akhir /Tesis",
          oddSemester: "23 Juli - 20 September 2024",
          evenSemester: "3 Februari - 8 Maret 2025",
        },
        {
          id: "I3",
          name: "Persetujuan Tinjauan Praujian Akhir (Dosen Pembimbing)",
          oddSemester: "17 September - 14 November 2024 (Pukul 18:00 WIB)",
          evenSemester: "3 Maret - 30 April 2025",
        },
        {
          id: "I4",
          name: "Pengajuan Tinjauan Praujian Akhir (Dosen Pembimbing)",
          oddSemester: "17 September - 15 November 2024 (Pukul 18:00 WIB)",
          evenSemester: "3 Maret - 2 Mei 2025",
        },
        {
          id: "I5",
          name: "Persetujuan Permohonan Ujian Akhir (Dosen Pembimbing) (Pukul 18:00 WIB)",
          oddSemester: "14 Oktober - 15 Januari 2025",
          evenSemester: "8 April - 3 Juli 2025\n28 Juli - 5 Agustus 2025",
        },
        {
          id: "I7",
          name: "Pelaksanaan Ujian Akhir",
          oddSemester: "3 Februari - 28 Februari 2025",
          evenSemester: "14 Juli - 23 Agustus 2025",
        },
      ],
    },
    {
      category: "J",
      name: "Upacara Wisuda",
      items: [
        {
          id: "J1",
          name: "Batas Akhir Pendaftaran dan Pembayaran Biaya Wisuda",
          oddSemester: "-",
          evenSemester: "6 September 2025",
        },
        {
          id: "J2",
          name: "Pengambilan Toga",
          oddSemester: "-",
          evenSemester: "11 Agustus - 6 September 2025",
        },
        {
          id: "J3",
          name: "Gladi Resik",
          oddSemester: "-",
          evenSemester: "10 Oktober 2025 (tentatif)",
        },
        {
          id: "J4",
          name: "Pelaksanaan",
          oddSemester: "-",
          evenSemester: "11 Oktober 2025 (tentatif)",
        },
      ],
    },
  ],
};

export const formatIndonesianDate = (dateStr) => {
  if (!dateStr || dateStr === "-") return "";

  try {
    // Handle month range in same year
    const sameYearMatch = dateStr.match(
      /(\d+)\s+([A-Za-z]+)\s*-\s*(\d+)\s+([A-Za-z]+)\s+(\d{4})/
    );
    if (sameYearMatch) {
      const [, startDay, startMonth, endDay, endMonth, year] = sameYearMatch;
      if (startMonth === endMonth) {
        return `${startDay} - ${endDay} ${startMonth} ${year}`;
      }
      return `${startDay} ${startMonth} - ${endDay} ${endMonth} ${year}`;
    }

    // Handle different years format
    const yearRangeMatch = dateStr.match(
      /(\d+)\s+([A-Za-z]+)\s+(\d{4})\s*-\s*(\d+)\s+([A-Za-z]+)\s+(\d{4})/
    );
    if (yearRangeMatch) {
      const [, startDay, startMonth, startYear, endDay, endMonth, endYear] =
        yearRangeMatch;
      return `${startDay} ${startMonth} ${startYear} - ${endDay} ${endMonth} ${endYear}`;
    }

    return dateStr;
  } catch (error) {
    console.error("Error formatting date:", error, dateStr);
    return dateStr;
  }
};

export const parseIndonesianDate = (dateStr) => {
  if (!dateStr || dateStr === "-") return null;

  const monthMap = {
    Januari: "01",
    Februari: "02",
    Maret: "03",
    April: "04",
    Mei: "05",
    Juni: "06",
    Juli: "07",
    Agustus: "08",
    September: "09",
    Oktober: "10",
    November: "11",
    Desember: "12",
  };

  try {
    // Handle single date (e.g., "4 Januari 2025")
    const singleDateMatch = dateStr.match(/^(\d+)\s+([A-Za-z]+)\s+(\d{4})$/);
    if (singleDateMatch) {
      const [, day, month, year] = singleDateMatch;
      const monthNumber = monthMap[month];
      if (!monthNumber) return null;
      return new Date(`${year}-${monthNumber}-${day.padStart(2, "0")}`);
    }

    const rangeDateMatch = dateStr.match(
      /(\d+)\s+([A-Za-z]+)(?:\s+(\d{4}))?\s*-\s*(\d+)\s+([A-Za-z]+)\s+(\d{4})/
    );
    if (rangeDateMatch) {
      const [, startDay, startMonth, startYear, , endMonth, endYear] =
        rangeDateMatch;
      const monthNumber = monthMap[startMonth];
      if (!monthNumber) return null;

      // If start year is not specified and it's December to January transition
      if (!startYear && startMonth === "Desember" && endMonth === "Januari") {
        // Use the previous year for December
        return new Date(
          `${endYear - 1}-${monthNumber}-${startDay.padStart(2, "0")}`
        );
      }

      // Use endYear for startYear if not specified
      const year = startYear || endYear;
      return new Date(`${year}-${monthNumber}-${startDay.padStart(2, "0")}`);
    }

    return null;
  } catch (error) {
    console.error("Error parsing date:", error, dateStr);
    return null;
  }
};

export const getUpcomingEvents = (academicCalendar, start = 0, limit = 5) => {
  const today = new Date();

  // Flatten all events
  const allEvents = academicCalendar.schedules.flatMap((schedule) =>
    schedule.items.flatMap((item) => {
      const events = [];

      if (item.oddSemester || item.evenSemester) {
        events.push({
          name: item.name,
          dates: [
            { date: item.oddSemester },
            { date: item.evenSemester },
          ].filter((d) => d.date && d.date !== "-"),
        });
      }

      if (item.subitems) {
        events.push(
          ...item.subitems.map((subitem) => ({
            name: subitem.name,
            dates: [
              { date: subitem.oddSemester },
              { date: subitem.evenSemester },
            ].filter((d) => d.date && d.date !== "-"),
          }))
        );
      }

      return events;
    })
  );

  const processedEvents = allEvents.flatMap((event) =>
    event.dates
      .map(({ date }) => {
        const parsedDate = parseIndonesianDate(date);
        return parsedDate
          ? {
              name: event.name,
              date,
              parsedDate,
            }
          : null;
      })
      .filter(Boolean)
  );

  const futureEvents = processedEvents
    .filter((event) => event.parsedDate >= today)
    .sort((a, b) => {
      if (a.parsedDate.getTime() === b.parsedDate.getTime()) {
        const aEndDate = parseEndDate(a.date);
        const bEndDate = parseEndDate(b.date);
        return aEndDate - bEndDate;
      }
      return a.parsedDate - b.parsedDate;
    });

  // Return paginated results
  return {
    events: futureEvents.slice(start, start + limit),
    hasMore: start + limit < futureEvents.length,
    total: futureEvents.length,
  };
};

const parseEndDate = (dateStr) => {
  const match = dateStr.match(/- (\d+) ([A-Za-z]+) (\d{4})/);
  if (match) {
    const [, day, month, year] = match;
    const monthNumber = monthMap[month];
    if (monthNumber) {
      return new Date(`${year}-${monthNumber}-${day.padStart(2, "0")}`);
    }
  }
  return new Date(0);
};

const monthMap = {
  Januari: "01",
  Februari: "02",
  Maret: "03",
  April: "04",
  Mei: "05",
  Juni: "06",
  Juli: "07",
  Agustus: "08",
  September: "09",
  Oktober: "10",
  November: "11",
  Desember: "12",
};
